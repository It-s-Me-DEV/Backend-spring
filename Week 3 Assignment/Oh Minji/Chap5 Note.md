# 데이터베이스 조작이 편해지는 ORM

## 데이터베이스

: 데이터를 매우 효율적으로 보관하고 꺼내볼 수 있는 곳. 많은 사람들이 안전하게 데이터를 사용하고, 관리할 수 있음

### 데이터베이스 관리자, DBMS 

: 데이터베이스를 관리하기 위한 소프트웨어 

  - 많은 사람들이 공유할 수 있어야 하므로 동시 접근을 할 수 있어야 함

  - 관리 특징에 따라서 관계형, 객체-관계형, 도큐먼트형, 비관계형으로 분류; 가장 많이 사용하는 DBMS는 관계형

    #### 관계형 DBMS, RDBMS

    : 관계형 모델을 기반으로 함

    eg)
    
    - H2: 자바로 작성되어 스프링 부트가 지원하는 인메모리 관계형 데이터베이스로 애플리케이션 자체 내부에 데이터를 저장하기 때문에 애플리케이션을 다시 실행하면 데이터가 초기화됨
      
    - MySQL: 개발 및 테스트에는 H2를 사용하고 실제 서비스에 올릴 때는 MySQL을 많이 사용함
   
### SQL 문으로 데이터베이스 조작하는 연습하기

이미 아는 내용이라 패스~

## ORM

: 자바의 객체와 데이터베이스를 연결하는 프로그래밍 기법

장점:
  
  - SQL을 직접 작성하지 않고 사용하는 언어로 데이터베이스에 접근할 수 있음

  - 객체지향적으로 코드를 작성할 수 있기 때문에 비즈니스 로직에만 집중할 수 있음

  - 데이터베이스 시스템이 추상화되어 있기 때문에 MySQL에서 PostgreSQL로 전환한다고 해도 추가로 드는 작업이 거의 없음; 데이터 종속성이 줄어듦

  - 매핑하는 정보가 명확하기 때문에 ERD에 대한 의존도를 낮출 수 있고 유지보수할 때 유리

단점: 

  - 프로젝트의 복잡성이 커질수록 사용 난이도도 올라감

  - 복잡하고 무거운 쿼리는 ORM으로 해결이 불가능한 경우가 있음

## JPA와 하이버네이트

: 자바에서 관계형 데이터베이스를 사용하는 방식을 정의한 인터페이스인 JPA를 실제로 사용하기 위해 하이버네이트와 같은 ORM 프레임워크를 사용하여 자바 객체를 통해 데이터베이스의 종류에 상관없이 데이터베이스를 자유자재로 사용할 수 있게 함

### 엔티티 매니저

: 엔티티를 관리해 데이터베이스와 애플리케이션 사이에서 객체를 생성, 수정, 삭제하는 등의 역할

  *엔티티: 데이터베이스의 테이블과 매핑되는 객체

- 엔티티 매니저 팩토리가 엔티티별로 엔티티 매니저를 생성하여 관리하는 것이 원칙이나 스프링 부트에서는 하나의 엔티티 매니저만을 생성하여 @Persistence Comtext와 @Autowired 애너테이션을 사용해서 엔티티 매니저를 사용함

- 프록시 매니저를 사용하여 필요할 때 데이터베이스 트랜잭션과 관련된 실제 엔티티 매니저를 호출하여 빈을 하나만 생성하여 공유하는 스프링 부트가 갖는 동시성의 문제를 해결함

- 엔티티 매니저는 엔티티를 영속성 컨텍스트에 저장 

### 영속성 컨텍스트 

: JPA의 중요한 특징 중 하나로, 엔티티를 관리하는 가상의 공간 

-> 데이터베이스에서 효과적으로 데이터를 가져올 수 있고 엔티티를 편하게 사용할 수 있음

특징:

  - 1차 캐시: 엔티티를 조회하면  1차 캐시에서 데이터를 조회하고 값이 있으면 반환하고 값이 없으면 데이터베이스에서 조회해 1차 캐시에서 데이터에 저장한 다음 반환함

    -> 빠르게 데이터를 조회할 수 있음

  - 쓰기 지연: 트랜잭션을 커밋하기 전까지는 데이터베이스에 실제로 질의문을 보내지 않고 쿼리를 모았다가 트랜잭션을 커밋하면 모았던 쿼리를 한번에 실행하는 것을 의미

    -> 데이터베이스 시스템의 부담 감소

  - 변경 감지: 트랜잭션을 커밋하면 1차 캐시 저장 엔티티 값과 현재 엔티티 값을 비교해 변경된 값을 데이터베이스에 자동 반영

    -> 데이터베이스 시스템의 부담 감소

  - 지연 로딩: 쿼리로 요청한 데이터를 바로 애플리케이션에 로딩하지 않고 필요할 때 쿼리를 날려 데이터를 조회

    -> 데이터베이스 접근을 최소화해 성능을 높임

### 엔티티의 상태 

: 특정 메서드를 호출해 엔티티의 상태를 조절하고 데이터를 올바르게 유지, 관리할 수 있음

1. 분리(detached)상태: 영속성 컨텍스트가 관리하고 있지 않음

2. 관리(managed)상태: 영속성 컨택스트가 관리하고 있음

3. 비영속(transient)상태: 영속성 컨택스트와 전혀 관계 없는 상태

4. 삭제된(removed)상태

## 스프링 데이터와 스프링 데이터 JPA

- 스프링 데이터: 비즈니스 로직에 더 집중할 수 있게 데이터베이스 사용 기능을 클래스 레벨에서 추상화하여 스프링 데이터에서 제공하는 인터페이스를 통해 사용할 수 있음

- 스프링 데이터 JPA: 스프링 데이터에 JPA의 유용한 기술이 추가된 것
